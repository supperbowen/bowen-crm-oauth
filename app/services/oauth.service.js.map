{"version":3,"sources":["../../src/services/oauth.service.js"],"names":["module","exports","getAccessToken","bearerToken","cb","console","log","findOne","accessToken","lean","then","r","e","getClient","clientId","clientSecret","callback","x","getRefreshToken","refreshToken","getUser","username","password","name","u","saveAccessToken","token","client","expires","user","accessTokenExpiresOn","refreshTokenExpiresOn","userId","id","save","res","err","grantTypeAllowed","grantType"],"mappings":"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","file":"oauth.service.js","sourcesContent":["/**\r\n * Module dependencies.\r\n */\r\nimport OAuthTokensModel from '../models/oauth.token.model'\r\nimport OAuthUsersModel from '../models/oauth.user.model';\r\nimport OAuthClientsModel from '../models/oauth.client.model';\r\n\r\n////////////////////////////////////////////////////////////////////////////////////////\r\n//NOTE: for oauth-node-server not supprting the import & export, so we use module.exports here!!!\r\n////////////////////////////////////////////////////////////////////////////////////////\r\n\r\n/**\r\n * Get access token.\r\n */\r\n\r\nmodule.exports.getAccessToken = function(bearerToken, cb) {\r\n\tconsole.log('in getAccessToken (bearerToken: ' + bearerToken + ')');\r\n\r\n\treturn OAuthTokensModel.findOne({\r\n\t\taccessToken: bearerToken\r\n\t}).lean().then(r => cb(null, r), e => cb(e));\r\n};\r\n\r\n/**\r\n * Get client.\r\n */\r\n\r\nmodule.exports.getClient = function(clientId, clientSecret, callback) {\r\n\tconsole.log('in getClient (clientId: ' + clientId + ', clientSecret: ' + clientSecret + ')');\r\n\r\n\treturn OAuthClientsModel.findOne({\r\n\t\tclientId: clientId,\r\n\t\tclientSecret: clientSecret\r\n\t}).lean().then(x => callback(null, x), e => callback(e));\r\n};\r\n\r\n/**\r\n * Get refresh token.\r\n */\r\n\r\nmodule.exports.getRefreshToken = function(refreshToken, cb) {\r\n\tconsole.log('in getRefreshToken (refreshToken: ' + refreshToken + ')');\r\n\r\n\treturn OAuthTokensModel.findOne({\r\n\t\trefreshToken: refreshToken\r\n\t}).lean().then(r => cb(null, r), e => cb(e));\r\n};\r\n\r\n/*\r\n * Get user.\r\n */\r\n\r\nmodule.exports.getUser = function(username, password, cb) {\r\n\tconsole.log('in getUser (username: ' + username + ', password: ' + password + ')');\r\n\r\n\treturn OAuthUsersModel.findOne({\r\n\t\tname: username,\r\n\t\tpassword: password\r\n\t}).lean().then(u => cb(null, u), e => cb(e));\r\n};\r\n\r\n/**\r\n * Save token.\r\n */\r\n\r\nmodule.exports.saveAccessToken = function(token, client, expires, user, cb) {\r\n\tconsole.log('in saveToken (token: ' + token + ')');\r\n\r\n\tvar accessToken = new OAuthTokensModel({\r\n\t\taccessToken: token,\r\n\t\texpires: expires,\r\n\t\taccessTokenExpiresOn: expires,\r\n\t\tclientId: client,\r\n\t\trefreshToken: token,\r\n\t\trefreshTokenExpiresOn: expires,\r\n\t\tuserId: user.id\r\n\t});\r\n\r\n\treturn accessToken.save().then((res) => cb(null, res), (err) => cb(err));\r\n};\r\n\r\n\r\nmodule.exports.grantTypeAllowed = function(clientId, grantType, cb) {\r\n\tconsole.log(true);\r\n\tcb(null, true);\r\n}\r\n"]}
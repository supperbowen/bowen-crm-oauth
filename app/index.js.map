{"version":3,"sources":["../src/index.js"],"names":["koaRouter","require","bodypraser","mount","oauthserver","model","Koa","app","oauth","grants","debug","use","middleware","post","grant","ctx","authorise","then","arg","console","log","body","get","routes","allowedMethods","mongoose","connect","dburl","listen"],"mappings":";;AAAA;;AAEA;;;;;;;;AADA,IAAIA,YAAY,IAAIC,OAAJ,CAAY,YAAZ,GAAhB;;;AAGA,IAAMC,aAAaD,QAAQ,gBAAR,CAAnB;AACA,IAAME,QAAQF,QAAQ,WAAR,CAAd;AACA,IAAMG,cAAcH,QAAQ,kBAAR,CAApB;AACA,IAAMI,QAAQJ,QAAQ,0BAAR,CAAd;;AAEA,IAAMK,MAAML,QAAQ,KAAR,CAAZ;AACA,IAAMM,MAAM,IAAID,GAAJ,EAAZ;;AAEAC,IAAIC,KAAJ,GAAYJ,YAAY;AACvBC,QAAOA,KADgB,EACT;AACdI,SAAQ,CAAC,UAAD,CAFe;AAGvBC,QAAO;AAHgB,CAAZ,CAAZ;;AAMAH,IAAII,GAAJ,CAAQT,YAAR;;AAEA;AACAK,IAAII,GAAJ,CAAQR,MAAM,SAAN,EAAiBH,UAAUY,UAAV,EAAjB,CAAR;;AAEA;AACAZ,UAAUa,IAAV,CAAe,QAAf,EAAyBN,IAAIC,KAAJ,CAAUM,KAAV,EAAzB;;AAEA;AACAd,UAAUa,IAAV,CAAe,YAAf;AAAA,sDAA6B,iBAAeE,GAAf;AAAA;AAAA;AAAA;AAAA;AAC5BR,UAAIC,KAAJ,CAAUQ,SAAV,KAAwBC,IAAxB,CAA6B,UAACC,GAAD,EAAO;AACnCC,eAAQC,GAAR,CAAYF,GAAZ;AACA,OAFD;AAGAH,UAAIM,IAAJ,GAAW,qBAAX;;AAJ4B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAA7B;;AAAA;AAAA;AAAA;AAAA;AAMA;;AAEArB,UAAUsB,GAAV,CAAc,OAAd,EAAuB,YAAW;AACjC,MAAKD,IAAL,GAAY,cAAZ;AACA,CAFD;;AAIA;AACA;AACA;AACA;;AAEAd,IAAII,GAAJ,CAAQX,UAAUuB,MAAV,EAAR,EACEZ,GADF,CACMX,UAAUwB,cAAV,EADN;;AAGA,IAAIC,WAAWxB,QAAQ,UAAR,CAAf;AACAwB,SAASC,OAAT,CAAiB,kBAAQC,KAAzB;;AAEApB,IAAIqB,MAAJ,CAAW,IAAX;AACAT,QAAQC,GAAR,CAAY,yCAAZ","file":"index.js","sourcesContent":["import 'babel-polyfill';\r\nvar koaRouter = new require('koa-router')();\r\nimport context from './common/context';\r\n\r\nconst bodypraser = require('koa-bodyparser');\r\nconst mount = require('koa-mount');\r\nconst oauthserver = require('koa-oauth-server');\r\nconst model = require('./services/oauth.service');\r\n\r\nconst Koa = require('koa');\r\nconst app = new Koa();\r\n\r\napp.oauth = oauthserver({\r\n\tmodel: model, // See https://github.com/thomseddon/node-oauth2-server for specification\r\n\tgrants: ['password'],\r\n\tdebug: true\r\n});\r\n\r\napp.use(bodypraser());\r\n\r\n// Mount `oauth2` route prefix.\r\napp.use(mount('/oauth2', koaRouter.middleware()));\r\n\r\n// Register `/token` POST path on oauth router (i.e. `/oauth2/token`).\r\nkoaRouter.post('/token', app.oauth.grant());\r\n\r\n//鉴权服务\r\nkoaRouter.post('/authorize', async function(ctx){\t\r\n\tapp.oauth.authorise()().then((arg)=>{\r\n\t\tconsole.log(arg);\r\n\t})\r\n\tctx.body = 'Hello Koa in app.js';\r\n});\r\n//app.use(app.oauth.authorise());\r\n\r\nkoaRouter.get('/test', function() {\r\n\tthis.body = 'hello world!';\r\n});\r\n\r\n// app.use(function *(next) {\r\n//   this.body = 'Secret area';\r\n//   yield next;\r\n// });\r\n\r\napp.use(koaRouter.routes())\r\n\t.use(koaRouter.allowedMethods());\r\n\r\nvar mongoose = require('mongoose');\r\nmongoose.connect(context.dburl);\r\n\r\napp.listen(8086);\r\nconsole.log('server started : http://localhost:8086/');\r\n"]}